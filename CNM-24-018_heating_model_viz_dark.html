<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CNM-24-018 District Heating Energy Model</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
  <script src="https://unpkg.com/prop-types@15/prop-types.min.js" crossorigin></script>
  <script src="https://unpkg.com/recharts@2.10.1/umd/Recharts.js" crossorigin></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body class="bg-gray-900">
  <div id="root"></div>
  
  <script type="text/babel">
    const { useState, useMemo } = React;
    const { ComposedChart, Line, Bar, XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer, ReferenceLine, ReferenceArea } = Recharts;

    const vizData = {"project_id": "CNM-24-018", "meter_id": "MTR00002", "meter_name": "District Heating", "provider": "Qiantan Energy Center", "fuel_type": "thermal_hhw", "model_type": "3P-H", "building_name": "NYU Shanghai Qiantan Campus", "gfa_m2": 114000, "baseline_period": {"start": "2023-06-01", "end": "2025-05-31", "n_months": 24}, "selected_balance_point": 16, "balance_points_tested": [14, 16, 18], "degree_day_type": "HDD", "active_season": "Nov-Mar", "emission_factor": 0.173, "models": {"14": {"beta_0": 0, "beta": 5442.8, "r_squared": 0.9663, "cv_rmse_pct": 25.48, "cv_rmse_active_pct": 16.47, "n_months_active": 10, "nmbe_pct": 2.11, "rmse": 91427.0}, "16": {"beta_0": 0, "beta": 4217.1, "r_squared": 0.9685, "cv_rmse_pct": 24.64, "cv_rmse_active_pct": 15.78, "n_months_active": 10, "nmbe_pct": -1.53, "rmse": 88396.0}, "18": {"beta_0": 0, "beta": 3396.3, "r_squared": 0.9591, "cv_rmse_pct": 28.08, "cv_rmse_active_pct": 17.41, "n_months_active": 10, "nmbe_pct": -4.69, "rmse": 100745.0}}, "monthly_data": [{"date": "2023-06", "date_label": "Jun 2023", "year": "Y1", "consumption": 0.0, "avg_temp": 25.9, "degree_days": {"14": 0.0, "16": 0.0, "18": 0.0}}, {"date": "2023-07", "date_label": "Jul 2023", "year": "Y1", "consumption": 0.0, "avg_temp": 29.9, "degree_days": {"14": 0.0, "16": 0.0, "18": 0.0}}, {"date": "2023-08", "date_label": "Aug 2023", "year": "Y1", "consumption": 0.0, "avg_temp": 29.3, "degree_days": {"14": 0.0, "16": 0.0, "18": 0.0}}, {"date": "2023-09", "date_label": "Sep 2023", "year": "Y1", "consumption": 0.0, "avg_temp": 26.3, "degree_days": {"14": 0.0, "16": 0.0, "18": 0.0}}, {"date": "2023-10", "date_label": "Oct 2023", "year": "Y1", "consumption": 0.0, "avg_temp": 20.9, "degree_days": {"14": 0.0, "16": 0.0, "18": 0.34}}, {"date": "2023-11", "date_label": "Nov 2023", "year": "Y1", "consumption": 272700.0, "avg_temp": 14.9, "degree_days": {"14": 37.83, "16": 74.1, "18": 118.81}}, {"date": "2023-12", "date_label": "Dec 2023", "year": "Y1", "consumption": 1078856.0, "avg_temp": 7.5, "degree_days": {"14": 214.32, "16": 269.05, "18": 326.75}}, {"date": "2024-01", "date_label": "Jan 2024", "year": "Y1", "consumption": 1444700.0, "avg_temp": 6.4, "degree_days": {"14": 236.49, "16": 298.49, "18": 360.49}}, {"date": "2024-02", "date_label": "Feb 2024", "year": "Y1", "consumption": 1111900.0, "avg_temp": 6.8, "degree_days": {"14": 213.01, "16": 266.73, "18": 323.45}}, {"date": "2024-03", "date_label": "Mar 2024", "year": "Y1", "consumption": 706800.0, "avg_temp": 11.9, "degree_days": {"14": 91.94, "16": 139.97, "18": 193.26}}, {"date": "2024-04", "date_label": "Apr 2024", "year": "Y1", "consumption": 16100.0, "avg_temp": 17.3, "degree_days": {"14": 1.93, "16": 12.61, "18": 38.18}}, {"date": "2024-05", "date_label": "May 2024", "year": "Y1", "consumption": 0.0, "avg_temp": 21.3, "degree_days": {"14": 0.0, "16": 0.0, "18": 2.99}}, {"date": "2024-06", "date_label": "Jun 2024", "year": "Y2", "consumption": 0.0, "avg_temp": 24.7, "degree_days": {"14": 0.0, "16": 0.0, "18": 0.0}}, {"date": "2024-07", "date_label": "Jul 2024", "year": "Y2", "consumption": 0.0, "avg_temp": 31.3, "degree_days": {"14": 0.0, "16": 0.0, "18": 0.0}}, {"date": "2024-08", "date_label": "Aug 2024", "year": "Y2", "consumption": 0.0, "avg_temp": 31.7, "degree_days": {"14": 0.0, "16": 0.0, "18": 0.0}}, {"date": "2024-09", "date_label": "Sep 2024", "year": "Y2", "consumption": 0.0, "avg_temp": 28.1, "degree_days": {"14": 0.0, "16": 0.0, "18": 0.0}}, {"date": "2024-10", "date_label": "Oct 2024", "year": "Y2", "consumption": 0.0, "avg_temp": 20.6, "degree_days": {"14": 0.0, "16": 0.0, "18": 2.95}}, {"date": "2024-11", "date_label": "Nov 2024", "year": "Y2", "consumption": 127700.0, "avg_temp": 15.6, "degree_days": {"14": 24.44, "16": 51.14, "18": 86.89}}, {"date": "2024-12", "date_label": "Dec 2024", "year": "Y2", "consumption": 975867.0, "avg_temp": 7.8, "degree_days": {"14": 193.01, "16": 255.01, "18": 317.01}}, {"date": "2025-01", "date_label": "Jan 2025", "year": "Y2", "consumption": 913533.0, "avg_temp": 7.0, "degree_days": {"14": 218.59, "16": 280.59, "18": 342.59}}, {"date": "2025-02", "date_label": "Feb 2025", "year": "Y2", "consumption": 1333900.0, "avg_temp": 6.4, "degree_days": {"14": 212.9, "16": 268.75, "18": 324.75}}, {"date": "2025-03", "date_label": "Mar 2025", "year": "Y2", "consumption": 628400.0, "avg_temp": 12.5, "degree_days": {"14": 101.27, "16": 145.27, "18": 191.75}}, {"date": "2025-04", "date_label": "Apr 2025", "year": "Y2", "consumption": 800.0, "avg_temp": 19.2, "degree_days": {"14": 3.05, "16": 11.49, "18": 24.14}}, {"date": "2025-05", "date_label": "May 2025", "year": "Y2", "consumption": 0.0, "avg_temp": 22.6, "degree_days": {"14": 0.0, "16": 0.0, "18": 0.0}}], "year_summary": [{"year": "Y1", "period": "Jun 23 \u2013 May 24", "total_kwh": 4631056.0, "eui": 40.6, "total_dd": 1061.0, "kwh_per_dd": 4365.0, "cost_cny": 2593391.0, "carbon_tco2": 801.0}, {"year": "Y2", "period": "Jun 24 \u2013 May 25", "total_kwh": 3980200.0, "eui": 34.9, "total_dd": 1012.0, "kwh_per_dd": 3932.0, "cost_cny": 2228912.0, "carbon_tco2": 689.0}]};

    const formatNumber = (num) => {
      if (num >= 1000000) return (num / 1000000).toFixed(2) + 'M';
      if (num >= 1000) return (num / 1000).toFixed(0) + 'k';
      return num.toFixed(0);
    };

    const formatCurrency = (num) => {
      if (num >= 1000000) return (num / 1000000).toFixed(2) + 'M';
      if (num >= 1000) return (num / 1000).toFixed(0) + 'k';
      return num.toFixed(0);
    };

    const CustomTooltip = ({ active, payload, balancePoint, ddType }) => {
      if (active && payload && payload.length) {
        const data = payload[0].payload;
        return (
          <div className="bg-gray-800 p-3 border border-gray-600 rounded shadow-lg text-sm">
            <p className="font-bold text-gray-100 mb-2">{data.date_label}</p>
            <div className="space-y-1">
              <p><span className="text-blue-400">●</span> Actual: <span className="font-semibold">{formatNumber(data.consumption)} kWh_th</span></p>
              <p><span className="text-red-500">●</span> Predicted: <span className="font-semibold">{formatNumber(data.predicted)} kWh_th</span></p>
              <p><span className="text-gray-500">●</span> Residual: <span className={`font-semibold ${data.residual >= 0 ? 'text-green-400' : 'text-red-400'}`}>
                {data.residual >= 0 ? '+' : ''}{formatNumber(data.residual)} ({data.residualPct >= 0 ? '+' : ''}{data.residualPct.toFixed(1)}%)
              </span></p>
              <hr className="my-1" />
              <p className="text-gray-300">{ddType}_{balancePoint}: {data.dd.toFixed(1)}</p>
              <p className="text-gray-300">Avg Temp: {data.avg_temp}°C</p>
              {data.isAnomaly && <p className="text-orange-400 font-semibold">⚠️ Anomaly</p>}
            </div>
          </div>
        );
      }
      return null;
    };

    const ResidualTooltip = ({ active, payload, balancePoint, ddType }) => {
      if (active && payload && payload.length) {
        const data = payload[0].payload;
        return (
          <div className="bg-gray-800 p-3 border border-gray-600 rounded shadow-lg text-sm">
            <p className="font-bold text-gray-100 mb-2">{data.date_label}</p>
            <div className="space-y-1">
              <p>Residual: <span className={`font-semibold ${data.residual >= 0 ? 'text-green-400' : 'text-red-400'}`}>
                {data.residual >= 0 ? '+' : ''}{formatNumber(data.residual)} kWh_th
              </span></p>
              <p className="text-amber-400">{ddType}_{balancePoint}: {data.dd.toFixed(1)}</p>
              {data.isAnomaly && <p className="text-orange-400 font-semibold">⚠️ Anomaly</p>}
            </div>
          </div>
        );
      }
      return null;
    };

    function EnergyModelVisualization() {
      const [balancePoint, setBalancePoint] = useState(vizData.selected_balance_point);
      const [yearFilter, setYearFilter] = useState('All');

      const currentModel = vizData.models[String(balancePoint)];
      const ddType = vizData.degree_day_type;

      const chartData = useMemo(() => {
        let filtered = vizData.monthly_data;
        if (yearFilter !== 'All') {
          filtered = filtered.filter(d => d.year === yearFilter);
        }

        return filtered.map(d => {
          const dd = d.degree_days[String(balancePoint)];
          const predicted = currentModel.beta_0 + currentModel.beta * dd;
          const residual = d.consumption - predicted;
          const residualPct = predicted > 0 ? (residual / predicted) * 100 : 0;
          const isAnomaly = Math.abs(residual) > currentModel.rmse * 1.5;

          return {
            ...d,
            dd,
            predicted,
            residual,
            residualPct,
            isAnomaly,
            consumptionK: d.consumption / 1000,
            predictedK: predicted / 1000,
            residualK: residual / 1000
          };
        });
      }, [balancePoint, yearFilter, currentModel]);

      const rmseK = currentModel.rmse / 1000;
      const g14ActiveColor = currentModel.cv_rmse_active_pct <= 15 ? 'text-green-400' : 'text-orange-400';
      const g14ActiveStatus = currentModel.cv_rmse_active_pct <= 15 ? 'PASS' : 'FAIL';

      // Calculate deltas for year summary
      const y1 = vizData.year_summary[0];
      const y2 = vizData.year_summary[1];
      const deltas = {
        total_pct: ((y2.total_kwh - y1.total_kwh) / y1.total_kwh * 100).toFixed(1),
        eui_abs: (y2.eui - y1.eui).toFixed(1),
        dd_pct: ((y2.total_dd - y1.total_dd) / y1.total_dd * 100).toFixed(1),
        kwh_per_dd_pct: ((y2.kwh_per_dd - y1.kwh_per_dd) / y1.kwh_per_dd * 100).toFixed(1),
        cost_pct: ((y2.cost_cny - y1.cost_cny) / y1.cost_cny * 100).toFixed(1),
        carbon_pct: ((y2.carbon_tco2 - y1.carbon_tco2) / y1.carbon_tco2 * 100).toFixed(1)
      };

      return (
        <div className="w-full max-w-6xl mx-auto p-4 bg-gray-900 font-sans">
          {/* Header */}
          <div className="bg-gray-800 rounded-lg shadow p-4 mb-4">
            <div className="flex flex-wrap gap-6 items-center">
              <div className="flex items-center gap-3">
                <label className="text-sm font-medium text-gray-200">Explore Balance Point:</label>
                <div className="flex items-center gap-2">
                  {vizData.balance_points_tested.map(bp => (
                    <button key={bp} onClick={() => setBalancePoint(bp)}
                      className={`px-3 py-1 rounded text-sm font-medium transition-colors ${balancePoint === bp ? 'bg-blue-600 text-white' : 'bg-gray-700 text-gray-200 hover:bg-gray-600'}`}>
                      {bp}°C
                    </button>
                  ))}
                </div>
              </div>
              <div className="flex items-center gap-3">
                <label className="text-sm font-medium text-gray-200">Year:</label>
                <div className="flex items-center gap-2">
                  {['All', 'Y1', 'Y2'].map(year => (
                    <button key={year} onClick={() => setYearFilter(year)}
                      className={`px-3 py-1 rounded text-sm font-medium transition-colors ${yearFilter === year ? 'bg-blue-600 text-white' : 'bg-gray-700 text-gray-200 hover:bg-gray-600'}`}>
                      {year}
                    </button>
                  ))}
                </div>
              </div>
            </div>
          </div>

          {/* Chart 1: Actual vs Predicted */}
          <div className="bg-gray-800 rounded-lg shadow p-4 mb-4">
            <h2 className="text-lg font-semibold text-gray-100 mb-2">Actual vs Predicted Consumption</h2>
            <ResponsiveContainer width="100%" height={280}>
              <ComposedChart data={chartData} margin={{ top: 10, right: 30, left: 10, bottom: 60 }}>
                <CartesianGrid strokeDasharray="3 3" stroke="#374151" />
                <XAxis dataKey="date_label" tick={{ fontSize: 10, fill: '#9CA3AF' }} interval={yearFilter === 'All' ? 2 : 0} angle={-45} textAnchor="end" />
                <YAxis tick={{ fontSize: 11, fill: '#9CA3AF' }} label={{ value: 'kWh_th (thousands)', angle: -90, position: 'insideLeft', fontSize: 11 }} tickFormatter={(v) => v.toFixed(0)} />
                <Tooltip content={<CustomTooltip balancePoint={balancePoint} ddType={ddType} />} />
                <Legend verticalAlign="top" height={36} />
                <Line type="monotone" dataKey="consumptionK" stroke="#60A5FA" strokeWidth={2}
                  dot={({ cx, cy, payload }) => (<circle cx={cx} cy={cy} r={payload.isAnomaly ? 6 : 4} fill={payload.isAnomaly ? '#f97316' : '#2563eb'} stroke={payload.isAnomaly ? '#ea580c' : '#1d4ed8'} strokeWidth={payload.isAnomaly ? 2 : 1} />)}
                  name="Actual" />
                <Line type="monotone" dataKey="predictedK" stroke="#F87171" strokeWidth={2} strokeDasharray="5 5" dot={false} name="Predicted" />
              </ComposedChart>
            </ResponsiveContainer>
          </div>

          {/* Chart 2: Residuals */}
          <div className="bg-gray-800 rounded-lg shadow p-4 mb-4">
            <h2 className="text-lg font-semibold text-gray-100 mb-2">Residuals & {ddType === 'CDD' ? 'Cooling' : 'Heating'} Degree Days</h2>
            <ResponsiveContainer width="100%" height={220}>
              <ComposedChart data={chartData} margin={{ top: 10, right: 60, left: 10, bottom: 60 }}>
                <CartesianGrid strokeDasharray="3 3" stroke="#374151" />
                <XAxis dataKey="date_label" tick={{ fontSize: 10, fill: '#9CA3AF' }} interval={yearFilter === 'All' ? 2 : 0} angle={-45} textAnchor="end" />
                <YAxis yAxisId="left" tick={{ fontSize: 11, fill: '#9CA3AF' }} label={{ value: 'Residual (thousands)', angle: -90, position: 'insideLeft', fontSize: 10 }} tickFormatter={(v) => v.toFixed(0)} />
                <YAxis yAxisId="right" orientation="right" tick={{ fontSize: 11, fill: '#9CA3AF' }} label={{ value: `${ddType}_${balancePoint}`, angle: 90, position: 'insideRight', fontSize: 10 }} />
                <Tooltip content={<ResidualTooltip balancePoint={balancePoint} ddType={ddType} />} />
                <Legend verticalAlign="top" height={36} />
                <ReferenceArea yAxisId="left" y1={-rmseK} y2={rmseK} fill="#22c55e" fillOpacity={0.15} />
                <ReferenceLine yAxisId="left" y={0} stroke="#1e3a5f" strokeWidth={1.5} />
                <Bar yAxisId="left" dataKey="residualK" name="Residual" fill="#60a5fa" stroke="#60A5FA" />
                <Line yAxisId="right" type="monotone" dataKey="dd" stroke="#f59e0b" strokeWidth={2} strokeDasharray="4 2" dot={false} name={`${ddType}_${balancePoint}`} />
              </ComposedChart>
            </ResponsiveContainer>
            <p className="text-xs text-gray-500 mt-1 text-center">Green band = ±RMSE ({formatNumber(currentModel.rmse)} kWh_th)</p>
          </div>

          {/* Model Stats & Annual Summary */}
          <div className="bg-gray-800 rounded-lg shadow p-4">
            <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
              {/* Model Equation - 1/3 width */}
              <div className="md:col-span-1">
                <h3 className="text-sm font-semibold text-gray-200 mb-2">Model Equation</h3>
                <div className="bg-gray-900 rounded p-2 font-mono text-sm">E = {currentModel.beta.toLocaleString()} × {ddType}<sub>{balancePoint}</sub></div>
                <div className="mt-2 grid grid-cols-2 gap-2 text-center">
                  <div className="bg-blue-900/50 rounded p-2"><p className="text-xs text-gray-500">R²</p><p className="text-base font-bold text-blue-400">{currentModel.r_squared.toFixed(3)}</p></div>
                  <div className="bg-gray-900 rounded p-2"><p className="text-xs text-gray-500">NMBE</p><p className="text-base font-bold text-gray-200">{currentModel.nmbe_pct.toFixed(1)}%</p></div>
                </div>
                <div className="mt-2 grid grid-cols-2 gap-2 text-center">
                  <div className="bg-gray-900 rounded p-2"><p className="text-xs text-gray-500">CV Full</p><p className="text-base font-bold text-gray-300">{currentModel.cv_rmse_pct.toFixed(1)}%</p></div>
                  <div className={`rounded p-2 ${currentModel.cv_rmse_active_pct <= 15 ? 'bg-green-900/50' : 'bg-orange-900/50'}`}>
                    <p className="text-xs text-gray-500">CV Active</p>
                    <p className={`text-base font-bold ${g14ActiveColor}`}>{currentModel.cv_rmse_active_pct.toFixed(1)}%</p>
                  </div>
                </div>
                <p className="text-xs mt-2 text-gray-500">G-14: CV ≤15% · Active: {vizData.active_season}</p>
              </div>
              
              {/* Annual Summary - 2/3 width */}
              <div className="md:col-span-2">
                <h3 className="text-sm font-semibold text-gray-200 mb-2">Annual Summary</h3>
                <div className="overflow-x-auto">
                  <table className="w-full text-sm">
                    <thead>
                      <tr className="bg-gray-900">
                        <th className="px-2 py-1 text-left">Period</th>
                        <th className="px-2 py-1 text-right">Total<br/><span className="font-normal text-gray-500">(kWh_th)</span></th>
                        <th className="px-2 py-1 text-right">EUI<br/><span className="font-normal text-gray-500">(kWh_th/m²)</span></th>
                        <th className="px-2 py-1 text-right">{ddType}<br/><span className="font-normal text-gray-500">(°C·days)</span></th>
                        <th className="px-2 py-1 text-right">kWh/DD<br/><span className="font-normal text-gray-500">(efficiency)</span></th>
                        <th className="px-2 py-1 text-right">Cost<br/><span className="font-normal text-gray-500">(CNY)</span></th>
                        <th className="px-2 py-1 text-right">Carbon<br/><span className="font-normal text-gray-500">(tCO₂e)</span></th>
                      </tr>
                    </thead>
                    <tbody>
                      {vizData.year_summary.map(ys => (
                        <tr key={ys.year} className={yearFilter !== 'All' && yearFilter !== ys.year ? 'opacity-40' : ''}>
                          <td className="px-2 py-1 font-medium">{ys.period}</td>
                          <td className="px-2 py-1 text-right">{formatNumber(ys.total_kwh)}</td>
                          <td className="px-2 py-1 text-right">{ys.eui.toFixed(1)}</td>
                          <td className="px-2 py-1 text-right">{ys.total_dd.toLocaleString()}</td>
                          <td className="px-2 py-1 text-right">{ys.kwh_per_dd.toLocaleString()}</td>
                          <td className="px-2 py-1 text-right">{formatCurrency(ys.cost_cny)}</td>
                          <td className="px-2 py-1 text-right">{ys.carbon_tco2}</td>
                        </tr>
                      ))}
                      <tr className="border-t border-gray-700 font-medium bg-gray-900">
                        <td className="px-2 py-1">Δ Y2−Y1</td>
                        <td className={`px-2 py-1 text-right ${parseFloat(deltas.total_pct) >= 0 ? 'text-red-400' : 'text-green-400'}`}>{deltas.total_pct >= 0 ? '+' : ''}{deltas.total_pct}%</td>
                        <td className={`px-2 py-1 text-right ${parseFloat(deltas.eui_abs) >= 0 ? 'text-red-400' : 'text-green-400'}`}>{deltas.eui_abs >= 0 ? '+' : ''}{deltas.eui_abs}</td>
                        <td className="px-2 py-1 text-right text-gray-500">{deltas.dd_pct >= 0 ? '+' : ''}{deltas.dd_pct}%</td>
                        <td className={`px-2 py-1 text-right ${parseFloat(deltas.kwh_per_dd_pct) >= 0 ? 'text-red-400' : 'text-green-400'}`}>{deltas.kwh_per_dd_pct >= 0 ? '+' : ''}{deltas.kwh_per_dd_pct}%</td>
                        <td className={`px-2 py-1 text-right ${parseFloat(deltas.cost_pct) >= 0 ? 'text-red-400' : 'text-green-400'}`}>{deltas.cost_pct >= 0 ? '+' : ''}{deltas.cost_pct}%</td>
                        <td className={`px-2 py-1 text-right ${parseFloat(deltas.carbon_pct) >= 0 ? 'text-red-400' : 'text-green-400'}`}>{deltas.carbon_pct >= 0 ? '+' : ''}{deltas.carbon_pct}%</td>
                      </tr>
                    </tbody>
                  </table>
                </div>
                <p className="text-xs text-gray-500 mt-2">kWh/DD = weather-normalized efficiency (lower is better) · Carbon EF: {vizData.emission_factor} kgCO₂e/kWh_th</p>
              </div>
            </div>
            
            {/* Balance Point Sensitivity */}
            <div className="mt-4 pt-4 border-t border-gray-700">
              <h3 className="text-sm font-semibold text-gray-200 mb-2">Balance Point Sensitivity</h3>
              <table className="w-full text-sm">
                <thead><tr className="bg-gray-900"><th className="px-3 py-1 text-left">BP</th><th className="px-3 py-1 text-right">β</th><th className="px-3 py-1 text-right">R²</th><th className="px-3 py-1 text-right">CV Full</th><th className="px-3 py-1 text-right">CV Active</th><th className="px-3 py-1 text-center">G-14</th></tr></thead>
                <tbody>
                  {vizData.balance_points_tested.map(bp => {
                    const m = vizData.models[String(bp)];
                    const isViewing = bp === balancePoint;
                    const isSelected = bp === vizData.selected_balance_point;
                    const passesActive = m.cv_rmse_active_pct <= 15;
                    return (
                      <tr key={bp} className={`cursor-pointer hover:bg-blue-900/50 ${isViewing ? 'bg-blue-900/30 font-semibold' : ''}`} onClick={() => setBalancePoint(bp)}>
                        <td className="px-3 py-1">{bp}°C {isSelected && <span className="ml-1 text-green-400">✓</span>}</td>
                        <td className="px-3 py-1 text-right">{m.beta.toLocaleString()}</td>
                        <td className="px-3 py-1 text-right">{m.r_squared.toFixed(3)}</td>
                        <td className="px-3 py-1 text-right text-gray-500">{m.cv_rmse_pct.toFixed(1)}%</td>
                        <td className={`px-3 py-1 text-right ${passesActive ? 'text-green-400' : 'text-orange-400'}`}>{m.cv_rmse_active_pct.toFixed(1)}%</td>
                        <td className={`px-3 py-1 text-center ${passesActive ? 'text-green-400' : 'text-orange-400'}`}>{passesActive ? '✓' : '✗'}</td>
                      </tr>
                    );
                  })}
                </tbody>
              </table>
              <p className="text-xs text-gray-500 mt-2">Active season: {vizData.active_season} (n={currentModel.n_months_active} months)</p>
            </div>
          </div>
        </div>
      );
    }

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<EnergyModelVisualization />);
  </script>
</body>
</html>